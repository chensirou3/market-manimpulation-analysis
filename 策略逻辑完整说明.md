# æç«¯åè½¬ç­–ç•¥ (Extreme Reversal Strategy) - å®Œæ•´é€»è¾‘è¯´æ˜

**ç­–ç•¥åç§°**: Extreme Manipulation Reversal Strategy
**ç­–ç•¥ç±»å‹**: åè½¬ç­–ç•¥ (Mean Reversion)
**æ ¸å¿ƒç†å¿µ**: æç«¯è¶‹åŠ¿ + é«˜æ“çºµåˆ†æ•° â†’ çŸ­æœŸåè½¬

---

## ğŸ“Š ç­–ç•¥æ ¸å¿ƒé€»è¾‘

### åŸºæœ¬å‡è®¾

**å¸‚åœºæ“çºµæ£€æµ‹å‡è®¾**:
1. å½“å¸‚åœºå‡ºç°**æç«¯ä»·æ ¼æ³¢åŠ¨** + **å¼‚å¸¸äº¤æ˜“ç‰¹å¾**æ—¶ï¼Œå¯èƒ½å­˜åœ¨å¸‚åœºæ“çºµ
2. æ“çºµè¡Œä¸ºå¾€å¾€å¯¼è‡´ä»·æ ¼**çŸ­æœŸè¿‡åº¦åç¦»**
3. è¿‡åº¦åç¦»åï¼Œä»·æ ¼å€¾å‘äº**çŸ­æœŸåè½¬**å›å½’

---

## ğŸ¯ å¼€ä»“é€»è¾‘ (Entry Logic)

### ç¬¬ä¸€æ­¥ï¼šè®¡ç®—è¶‹åŠ¿å¼ºåº¦ (Trend Strength)

#### 1.1 ç´¯è®¡æ”¶ç›Š (R_past)
```
R_past = sum(returns[t-L_past+1 : t])
```
- **L_past = 5 bars**: è¿‡å»5æ ¹Kçº¿çš„ç´¯è®¡æ”¶ç›Š
- **å«ä¹‰**: è¡¡é‡æœ€è¿‘çš„ä»·æ ¼è¶‹åŠ¿æ–¹å‘å’Œå¼ºåº¦
- **ä¾‹å­**: å¦‚æœè¿‡å»5æ ¹30åˆ†é’ŸKçº¿éƒ½ä¸Šæ¶¨ï¼ŒR_pastä¸ºæ­£ä¸”è¾ƒå¤§

#### 1.2 æ»šåŠ¨æ³¢åŠ¨ç‡ (sigma)
```
sigma = std(returns[t-vol_window+1 : t])
```
- **vol_window = 20 bars**: è¿‡å»20æ ¹Kçº¿çš„æ”¶ç›Šç‡æ ‡å‡†å·®
- **å«ä¹‰**: è¡¡é‡å¸‚åœºæ³¢åŠ¨æ€§
- **ä½œç”¨**: ç”¨äºæ ‡å‡†åŒ–è¶‹åŠ¿å¼ºåº¦

#### 1.3 æ ‡å‡†åŒ–è¶‹åŠ¿å¼ºåº¦ (TS)
```
TS = R_past / sigma
```
- **å«ä¹‰**: æ³¢åŠ¨ç‡è°ƒæ•´åçš„è¶‹åŠ¿å¼ºåº¦
- **ä½œç”¨**: æ¶ˆé™¤ä¸åŒå¸‚åœºç¯å¢ƒä¸‹æ³¢åŠ¨ç‡çš„å½±å“
- **ä¾‹å­**: 
  - TS = +3.0 â†’ å¼ºçƒˆä¸Šæ¶¨è¶‹åŠ¿ï¼ˆ3å€æ ‡å‡†å·®ï¼‰
  - TS = -3.0 â†’ å¼ºçƒˆä¸‹è·Œè¶‹åŠ¿ï¼ˆ-3å€æ ‡å‡†å·®ï¼‰

---

### ç¬¬äºŒæ­¥ï¼šè¯†åˆ«æç«¯è¶‹åŠ¿ (Extreme Trend)

#### 2.1 è®¡ç®—æç«¯è¶‹åŠ¿é˜ˆå€¼
```
T_trend = quantile(|TS|, q=0.9)
```
- **q_extreme_trend = 0.9**: ä½¿ç”¨90åˆ†ä½æ•°
- **å«ä¹‰**: å†å²ä¸Šæœ€æç«¯çš„10%çš„è¶‹åŠ¿å¼ºåº¦
- **ä¾‹å­**: å¦‚æœT_trend = 3.65ï¼Œåˆ™|TS| > 3.65æ—¶ä¸ºæç«¯è¶‹åŠ¿

#### 2.2 åˆ¤æ–­æç«¯è¶‹åŠ¿
```
extreme_trend = (|TS| > T_trend)
```
- **æç«¯ä¸Šæ¶¨**: TS > +3.65
- **æç«¯ä¸‹è·Œ**: TS < -3.65

---

### ç¬¬ä¸‰æ­¥ï¼šè¯†åˆ«é«˜æ“çºµåˆ†æ•° (High ManipScore)

#### 3.1 è®¡ç®—ManipScoreé˜ˆå€¼
```
M_thresh = quantile(ManipScore, q=0.9)
```
- **q_manip = 0.9**: ä½¿ç”¨90åˆ†ä½æ•°
- **å«ä¹‰**: å†å²ä¸Šæœ€å¼‚å¸¸çš„10%çš„äº¤æ˜“è¡Œä¸º
- **ä¾‹å­**: å¦‚æœM_thresh = 0.78ï¼Œåˆ™ManipScore > 0.78æ—¶ä¸ºé«˜æ“çºµ

#### 3.2 åˆ¤æ–­é«˜æ“çºµ
```
high_manip = (ManipScore > M_thresh)
```

**ManipScoreè®¡ç®—** (åœ¨æ•°æ®é¢„å¤„ç†é˜¶æ®µå®Œæˆ):
```
ManipScore = æ ‡å‡†åŒ–æ®‹å·® from regression:
    |returns| ~ N_ticks + spread_mean + RV + |ret_lag1| + |ret_lag2|
```
- **å«ä¹‰**: å½“å‰ä»·æ ¼æ³¢åŠ¨ç›¸å¯¹äºå¾®è§‚ç»“æ„ç‰¹å¾çš„å¼‚å¸¸ç¨‹åº¦
- **é«˜ManipScore**: ä»·æ ¼æ³¢åŠ¨æ— æ³•ç”¨æ­£å¸¸äº¤æ˜“ç‰¹å¾è§£é‡Šï¼Œå¯èƒ½å­˜åœ¨æ“çºµ

---

### ç¬¬å››æ­¥ï¼šç”Ÿæˆäº¤æ˜“ä¿¡å· (Signal Generation)

#### 4.1 ä¿¡å·æ¡ä»¶
```
signal_condition = extreme_trend AND high_manip
```
- **å¿…é¡»åŒæ—¶æ»¡è¶³**:
  1. æç«¯è¶‹åŠ¿ (|TS| > T_trend)
  2. é«˜æ“çºµåˆ†æ•° (ManipScore > M_thresh)

#### 4.2 åè½¬é€»è¾‘
```
IF signal_condition:
    IF R_past > 0:  # æç«¯ä¸Šæ¶¨
        signal = -1  # åšç©ºï¼Œé¢„æœŸåè½¬ä¸‹è·Œ
    ELIF R_past < 0:  # æç«¯ä¸‹è·Œ
        signal = +1  # åšå¤šï¼Œé¢„æœŸåè½¬ä¸Šæ¶¨
ELSE:
    signal = 0  # æ— äº¤æ˜“
```

**æ ¸å¿ƒç†å¿µ**: 
- **æç«¯ä¸Šæ¶¨ + é«˜æ“çºµ** â†’ å¯èƒ½æ˜¯æ‹‰ç›˜ï¼Œé¢„æœŸå›è½ â†’ **åšç©º**
- **æç«¯ä¸‹è·Œ + é«˜æ“çºµ** â†’ å¯èƒ½æ˜¯ç ¸ç›˜ï¼Œé¢„æœŸåå¼¹ â†’ **åšå¤š**

#### 4.3 é¿å…å‰è§†åå·® (Avoid Look-Ahead Bias)
```
exec_signal[t] = raw_signal[t-1]
```
- **raw_signal[t]**: åŸºäºtæ—¶åˆ»åŠä¹‹å‰çš„ä¿¡æ¯ç”Ÿæˆçš„ä¿¡å·
- **exec_signal[t]**: åœ¨tæ—¶åˆ»æ‰§è¡Œçš„ä¿¡å·ï¼ˆåŸºäºt-1çš„ä¿¡å·ï¼‰
- **æ‰§è¡Œä»·æ ¼**: tæ—¶åˆ»çš„å¼€ç›˜ä»· (open[t])

---

### ç¬¬äº”æ­¥ï¼šLong-Onlyè¿‡æ»¤ (ä»…ç”¨äºLong-Onlyç­–ç•¥)

```
IF exec_signal == -1:  # åšç©ºä¿¡å·
    exec_signal = 0     # è¿‡æ»¤æ‰ï¼Œä¸äº¤æ˜“
```
- **Long-Onlyç­–ç•¥**: åªä¿ç•™åšå¤šä¿¡å· (+1)ï¼Œè¿‡æ»¤æ‰åšç©ºä¿¡å· (-1)
- **Symmetricç­–ç•¥**: ä¿ç•™æ‰€æœ‰ä¿¡å· (+1 å’Œ -1)

---

## ğŸšª å¹³ä»“é€»è¾‘ (Exit Logic)

### å¼€ä»“æ—¶è®¾ç½®æ­¢æŸæ­¢ç›ˆ

#### è®¡ç®—ATR (Average True Range)
```
TR = max(high - low, |high - close_prev|, |low - close_prev|)
ATR = rolling_mean(TR, window=10)
```
- **ATR_window = 10 bars**: è¿‡å»10æ ¹Kçº¿çš„å¹³å‡çœŸå®æ³¢å¹…
- **å«ä¹‰**: è¡¡é‡å¸‚åœºæ³¢åŠ¨å¹…åº¦

#### è®¾ç½®æ­¢æŸæ­¢ç›ˆä»·æ ¼

**åšå¤š (Long)**:
```
entry_price = open[t]
sl_price = entry_price - 0.5 * ATR  # æ­¢æŸ
tp_price = entry_price + 0.8 * ATR  # æ­¢ç›ˆ
```

**åšç©º (Short)**:
```
entry_price = open[t]
sl_price = entry_price + 0.5 * ATR  # æ­¢æŸ
tp_price = entry_price - 0.8 * ATR  # æ­¢ç›ˆ
```

**å‚æ•°**:
- **sl_atr_mult = 0.5**: æ­¢æŸä¸º0.5å€ATR
- **tp_atr_mult = 0.8**: æ­¢ç›ˆä¸º0.8å€ATR

---

### å¹³ä»“æ¡ä»¶ (æŒ‰ä¼˜å…ˆçº§)

#### 1. æ­¢æŸ (Stop Loss) - æœ€é«˜ä¼˜å…ˆçº§
```
IF direction == LONG:
    IF low[t] <= sl_price:
        exit_price = sl_price
        exit_reason = 'SL'
        
IF direction == SHORT:
    IF high[t] >= sl_price:
        exit_price = sl_price
        exit_reason = 'SL'
```
- **è§¦å‘**: ä»·æ ¼è§¦åŠæ­¢æŸä»·ä½
- **æ‰§è¡Œ**: ç«‹å³å¹³ä»“ï¼Œä»·æ ¼ä¸ºæ­¢æŸä»·
- **ç›®çš„**: æ§åˆ¶å•ç¬”äºæŸ

#### 2. æ­¢ç›ˆ (Take Profit) - ç¬¬äºŒä¼˜å…ˆçº§
```
IF direction == LONG:
    IF high[t] >= tp_price:
        exit_price = tp_price
        exit_reason = 'TP'
        
IF direction == SHORT:
    IF low[t] <= tp_price:
        exit_price = tp_price
        exit_reason = 'TP'
```
- **è§¦å‘**: ä»·æ ¼è§¦åŠæ­¢ç›ˆä»·ä½
- **æ‰§è¡Œ**: ç«‹å³å¹³ä»“ï¼Œä»·æ ¼ä¸ºæ­¢ç›ˆä»·
- **ç›®çš„**: é”å®šç›ˆåˆ©

#### 3. æ—¶é—´æ­¢æŸ (Time-Based Exit) - ç¬¬ä¸‰ä¼˜å…ˆçº§
```
IF bars_held >= holding_horizon:
    exit_price = open[t]
    exit_reason = 'TIME'
```
- **holding_horizon = 5 bars**: æœ€å¤šæŒä»“5æ ¹Kçº¿
- **è§¦å‘**: æŒä»“æ—¶é—´è¾¾åˆ°5æ ¹Kçº¿
- **æ‰§è¡Œ**: ä¸‹ä¸€æ ¹Kçº¿å¼€ç›˜ä»·å¹³ä»“
- **ç›®çš„**: é¿å…é•¿æœŸæŒä»“ï¼Œä¿æŒç­–ç•¥çš„çŸ­æœŸåè½¬ç‰¹æ€§

#### 4. å›æµ‹ç»“æŸ (End of Backtest)
```
IF t == last_bar:
    exit_price = close[t]
    exit_reason = 'END'
```
- **è§¦å‘**: å›æµ‹æ•°æ®ç»“æŸ
- **æ‰§è¡Œ**: æœ€åä¸€æ ¹Kçº¿æ”¶ç›˜ä»·å¹³ä»“
- **ç›®çš„**: æ¸…ç®—æ‰€æœ‰æŒä»“

---

## ğŸ’° ç›ˆäºè®¡ç®— (PnL Calculation)

### ç™¾åˆ†æ¯”æ”¶ç›Š
```
IF direction == LONG:
    pnl_pct = (exit_price - entry_price) / entry_price
    
IF direction == SHORT:
    pnl_pct = (entry_price - exit_price) / entry_price
```

### æ‰£é™¤äº¤æ˜“æˆæœ¬
```
pnl_pct = pnl_pct - cost_per_trade
```
- **cost_per_trade = 0.0007**: å•è¾¹0.07% (7bp)
- **å«ä¹‰**: åŒ…å«æ»‘ç‚¹ã€æ‰‹ç»­è´¹ç­‰

### ç»å¯¹ç›ˆäº
```
pnl = equity * pnl_pct
equity = equity + pnl
```
- **equity**: å½“å‰è´¦æˆ·æƒç›Š
- **pnl**: æœ¬æ¬¡äº¤æ˜“çš„ç»å¯¹ç›ˆäº
- **æ›´æ–°**: æ¯æ¬¡äº¤æ˜“åæ›´æ–°è´¦æˆ·æƒç›Š

---

## ğŸ“‹ å®Œæ•´äº¤æ˜“æµç¨‹ç¤ºä¾‹

### ç¤ºä¾‹ï¼šBTC 30min Long-Onlyç­–ç•¥

**æ—¶é—´**: 2024-01-15 10:00

#### å¼€ä»“å‰æ£€æŸ¥
1. **è®¡ç®—è¶‹åŠ¿å¼ºåº¦**:
   - R_past = +0.025 (è¿‡å»5æ ¹Kçº¿ç´¯è®¡ä¸Šæ¶¨2.5%)
   - sigma = 0.008 (æ³¢åŠ¨ç‡0.8%)
   - TS = +0.025 / 0.008 = +3.125

2. **æ£€æŸ¥æç«¯è¶‹åŠ¿**:
   - T_trend = 3.65 (90åˆ†ä½æ•°é˜ˆå€¼)
   - |TS| = 3.125 < 3.65 â†’ **ä¸æ˜¯æç«¯è¶‹åŠ¿**
   - **ä¸æ»¡è¶³å¼€ä»“æ¡ä»¶ï¼Œä¸äº¤æ˜“**

---

**æ—¶é—´**: 2024-01-15 10:30

#### å¼€ä»“å‰æ£€æŸ¥
1. **è®¡ç®—è¶‹åŠ¿å¼ºåº¦**:
   - R_past = +0.032 (è¿‡å»5æ ¹Kçº¿ç´¯è®¡ä¸Šæ¶¨3.2%)
   - sigma = 0.008
   - TS = +0.032 / 0.008 = +4.0

2. **æ£€æŸ¥æç«¯è¶‹åŠ¿**:
   - |TS| = 4.0 > 3.65 â†’ âœ… **æç«¯ä¸Šæ¶¨è¶‹åŠ¿**

3. **æ£€æŸ¥æ“çºµåˆ†æ•°**:
   - ManipScore = 0.85
   - M_thresh = 0.78
   - 0.85 > 0.78 â†’ âœ… **é«˜æ“çºµåˆ†æ•°**

4. **ç”Ÿæˆä¿¡å·**:
   - extreme_trend = True
   - high_manip = True
   - R_past > 0 â†’ **æç«¯ä¸Šæ¶¨**
   - raw_signal = -1 (åšç©º)

5. **Long-Onlyè¿‡æ»¤**:
   - signal = -1 â†’ è¿‡æ»¤æ‰
   - **ä¸äº¤æ˜“**

---

**æ—¶é—´**: 2024-01-15 14:00

#### å¼€ä»“å‰æ£€æŸ¥
1. **è®¡ç®—è¶‹åŠ¿å¼ºåº¦**:
   - R_past = -0.028 (è¿‡å»5æ ¹Kçº¿ç´¯è®¡ä¸‹è·Œ2.8%)
   - sigma = 0.007
   - TS = -0.028 / 0.007 = -4.0

2. **æ£€æŸ¥æç«¯è¶‹åŠ¿**:
   - |TS| = 4.0 > 3.65 â†’ âœ… **æç«¯ä¸‹è·Œè¶‹åŠ¿**

3. **æ£€æŸ¥æ“çºµåˆ†æ•°**:
   - ManipScore = 0.92
   - 0.92 > 0.78 â†’ âœ… **é«˜æ“çºµåˆ†æ•°**

4. **ç”Ÿæˆä¿¡å·**:
   - R_past < 0 â†’ **æç«¯ä¸‹è·Œ**
   - raw_signal = +1 (åšå¤š)

5. **Long-Onlyä¿ç•™**:
   - signal = +1 â†’ âœ… **å¼€å¤šä»“**

#### å¼€ä»“æ‰§è¡Œ (14:30)
```
entry_time = 2024-01-15 14:30
entry_price = $42,500 (14:30çš„å¼€ç›˜ä»·)
direction = LONG (+1)
ATR = $150

sl_price = $42,500 - 0.5 * $150 = $42,425
tp_price = $42,500 + 0.8 * $150 = $42,620
```

#### æŒä»“ç›‘æ§

**14:30 - 15:00** (ç¬¬1æ ¹Kçº¿):
- high = $42,580, low = $42,480
- æœªè§¦åŠSL ($42,425) æˆ– TP ($42,620)
- bars_held = 1 < 5
- **ç»§ç»­æŒä»“**

**15:00 - 15:30** (ç¬¬2æ ¹Kçº¿):
- high = $42,650, low = $42,520
- high = $42,650 > tp_price = $42,620 â†’ âœ… **è§¦åŠæ­¢ç›ˆ**

#### å¹³ä»“æ‰§è¡Œ
```
exit_time = 2024-01-15 15:00-15:30ä¹‹é—´
exit_price = $42,620 (æ­¢ç›ˆä»·)
exit_reason = 'TP'
bars_held = 2

pnl_pct = ($42,620 - $42,500) / $42,500 = +0.282%
pnl_pct = +0.282% - 0.07% = +0.212% (æ‰£é™¤æˆæœ¬)

pnl = $10,000 * 0.00212 = +$21.2
equity = $10,000 + $21.2 = $10,021.2
```

---

## ğŸ¯ ç­–ç•¥å‚æ•°æ€»ç»“

| å‚æ•°ç±»åˆ« | å‚æ•°å | é»˜è®¤å€¼ | è¯´æ˜ |
|---------|--------|--------|------|
| **è¶‹åŠ¿å‚æ•°** | L_past | 5 | ç´¯è®¡æ”¶ç›Šå›çœ‹çª—å£ |
| | vol_window | 20 | æ³¢åŠ¨ç‡è®¡ç®—çª—å£ |
| | q_extreme_trend | 0.9 | æç«¯è¶‹åŠ¿åˆ†ä½æ•° |
| **æ“çºµå‚æ•°** | q_manip | 0.9 | é«˜æ“çºµåˆ†æ•°åˆ†ä½æ•° |
| **æ‰§è¡Œå‚æ•°** | holding_horizon | 5 | æœ€å¤§æŒä»“æ—¶é—´ |
| | atr_window | 10 | ATRè®¡ç®—çª—å£ |
| | sl_atr_mult | 0.5 | æ­¢æŸå€æ•° |
| | tp_atr_mult | 0.8 | æ­¢ç›ˆå€æ•° |
| | cost_per_trade | 0.0007 | äº¤æ˜“æˆæœ¬ (7bp) |

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-11-16
**ç­–ç•¥ç‰ˆæœ¬**: v1.0

