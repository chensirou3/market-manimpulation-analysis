# Dynamic Strength-Based Exit System Report (Layer 3)
# åŸºäºŽä¿¡å·å¼ºåº¦çš„åŠ¨æ€é€€å‡ºç³»ç»ŸæŠ¥å‘Šï¼ˆç¬¬ä¸‰å±‚ï¼‰

**æµ‹è¯•æ—¥æœŸ**: 2025-01-17  
**æµ‹è¯•èµ„äº§**: BTCUSD 4H, XAUUSD 4H  
**æµ‹è¯•æœŸé—´**: 2016-2024 (XAUUSD 9å¹´), 2024 (BTCUSD 1å¹´)

---

## ðŸ“Š æ ¸å¿ƒæ¦‚å¿µ

### Layer 3: Signal-Strength-Based Dynamic Exit

**æ ¸å¿ƒæ€æƒ³**: æ ¹æ®å…¥åœºä¿¡å·çš„å¼ºåº¦åŠ¨æ€é€‰æ‹©é€€å‡ºè§„åˆ™

- **Strong signals** (é«˜TS & é«˜ManipScore) â†’ å®½æ­¢æŸ / æ™šè¿½è¸ª / å®½æ¾é€€å‡º
- **Medium signals** (ä¸­ç­‰å¼ºåº¦) â†’ ä¸­ç­‰å‚æ•°
- **Weak signals** (æŽ¥è¿‘é˜ˆå€¼) â†’ ç´§æ­¢æŸ / æ—©æ­¢ç›ˆ / çŸ­æŒä»“

### ä¿¡å·å¼ºåº¦åˆ†æ¡£é€»è¾‘

åŸºäºŽå…¥åœºæ—¶åˆ»çš„ä¸¤ä¸ªç‰¹å¾ï¼š
1. **|entry_TS|**: è¶‹åŠ¿å¼ºåº¦çš„ç»å¯¹å€¼
2. **entry_ManipScore**: æ“çºµæ£€æµ‹åˆ†æ•°

**åˆ†æ¡£è§„åˆ™**:
- **Strong**: |TS| >= 70th percentile AND ManipScore >= 70th percentile
- **Weak**: |TS| <= 30th percentile AND ManipScore <= 30th percentile
- **Medium**: å…¶ä»–æƒ…å†µ

---

## ðŸŽ¯ é€€å‡ºè§„åˆ™é…ç½®

### BTCUSD 4H è§„åˆ™

| å¼ºåº¦ | è§„åˆ™åç§° | SL (ATR) | TP (ATR) | Max Bars | Trail Trigger | Trail Lock |
|------|----------|----------|----------|----------|---------------|------------|
| **Strong** | Trail_T3_L1.5_SL4 | 4.0 | âˆž | 30 | 3.0 | 1.5 |
| **Medium** | Trail_T2_L1_SL3 | 3.0 | âˆž | 20 | 2.0 | 1.0 |
| **Weak** | Static_SL2_TP1.5_max15 | 2.0 | 1.5 | 15 | âˆž | 0 |

**è®¾è®¡ç†å¿µ**:
- Strong: å®½æ­¢æŸ(4 ATR)ï¼Œæ™šè§¦å‘è¿½è¸ª(3 ATR)ï¼Œé”å®šæ›´å¤šåˆ©æ¶¦(1.5 ATR)
- Medium: ä¸­ç­‰å‚æ•°ï¼Œå¹³è¡¡é£Žé™©æ”¶ç›Š
- Weak: ç´§æ­¢æŸ(2 ATR)ï¼Œæ—©æ­¢ç›ˆ(1.5 ATR)ï¼Œå¿«é€Ÿé€€å‡º

### XAUUSD 4H è§„åˆ™

| å¼ºåº¦ | è§„åˆ™åç§° | SL (ATR) | TP (ATR) | Max Bars | Trail Trigger | Trail Lock |
|------|----------|----------|----------|----------|---------------|------------|
| **Strong** | Static_SL5_NoTP_max30 | 5.0 | âˆž | 30 | âˆž | 0 |
| **Medium** | Static_SL4_TP3_max20 | 4.0 | 3.0 | 20 | âˆž | 0 |
| **Weak** | Static_SL2_TP1.5_max15 | 2.0 | 1.5 | 15 | âˆž | 0 |

**è®¾è®¡ç†å¿µ**:
- XAUä¹‹å‰æµ‹è¯•æ˜¾ç¤ºåŠ¨æ€è¿½è¸ªæ”¶ç›Šæœ‰é™ï¼Œå› æ­¤ä½¿ç”¨é™æ€è§„åˆ™
- Strong: å®½æ­¢æŸï¼Œæ— æ­¢ç›ˆï¼Œè®©åˆ©æ¶¦å¥”è·‘
- Weak: ç´§æ­¢æŸï¼Œæ—©æ­¢ç›ˆï¼Œå¿«é€Ÿé€€å‡º

---

## ðŸ“ˆ æµ‹è¯•ç»“æžœ

### BTCUSD 4H (2024å¹´, 1å¹´æ•°æ®)

| ç­–ç•¥ | æ€»æ”¶ç›Š | Sharpe | èƒœçŽ‡ | äº¤æ˜“æ•° | æœ€å¤§å›žæ’¤ | å¹´åŒ–æ”¶ç›Š |
|------|--------|--------|------|--------|----------|----------|
| **Pure Baseline** | **40.56%** | 1.40 | 33.3% | 6 | -20.79% | 40.60% |
| **Best Static** | 33.44% | 1.79 | 61.0% | 41 | -10.61% | 33.48% |
| **ðŸ† Dynamic Strength** | **101.42%** | **2.31** | **68.8%** | 32 | -12.58% | **71.13%** |

**ä¿¡å·å¼ºåº¦åˆ†å¸ƒ** (54ä¸ªä¿¡å·):
- Strong: 4 (7.4%)
- Medium: 45 (83.3%)
- Weak: 5 (9.3%)

**æŒ‰å¼ºåº¦è¡¨çŽ°**:
- **Strong**: 4ç¬”äº¤æ˜“, èƒœçŽ‡50.0%, å¹³å‡PnL=-1.59% âš ï¸
- **Medium**: 23ç¬”äº¤æ˜“, èƒœçŽ‡69.6%, å¹³å‡PnL=+2.82% âœ…
- **Weak**: 5ç¬”äº¤æ˜“, èƒœçŽ‡80.0%, å¹³å‡PnL=+3.59% âœ…âœ…

**å…³é”®å‘çŽ°**:
1. âœ… **Dynamic Strengthç­–ç•¥å¤§å¹…é¢†å…ˆ**: æ€»æ”¶ç›Š101.42% vs Pure 40.56% (+150%)
2. âœ… **Sharpeæå‡**: 2.31 vs Pure 1.40 (+65%)
3. âš ï¸ **Strongä¿¡å·è¡¨çŽ°ä¸ä½³**: å¹³å‡PnLä¸ºè´Ÿï¼Œå¯èƒ½æ˜¯2024å¹´ç‰¹æ®Šå¸‚åœºçŽ¯å¢ƒ
4. âœ… **Weakä¿¡å·è¡¨çŽ°æœ€å¥½**: èƒœçŽ‡80%ï¼Œè¯´æ˜Žç´§æ­¢æŸ/æ—©æ­¢ç›ˆç­–ç•¥æœ‰æ•ˆ

### XAUUSD 4H (2016-2024, 9å¹´æ•°æ®)

| ç­–ç•¥ | æ€»æ”¶ç›Š | Sharpe | èƒœçŽ‡ | äº¤æ˜“æ•° | æœ€å¤§å›žæ’¤ | å¹´åŒ–æ”¶ç›Š |
|------|--------|--------|------|--------|----------|----------|
| **Pure Baseline** | **13.52%** | **0.76** | 30.3% | 33 | -4.51% | 1.95% |
| **Best Static** | 2.98% | 0.21 | 54.8% | 186 | -7.56% | 0.45% |
| **Dynamic Strength** | **21.26%** | 0.26 | 52.9% | 204 | **-19.84%** | 2.27% |

**ä¿¡å·å¼ºåº¦åˆ†å¸ƒ** (299ä¸ªä¿¡å·):
- Strong: 28 (9.4%)
- Medium: 242 (80.9%)
- Weak: 29 (9.7%)

**æŒ‰å¼ºåº¦è¡¨çŽ°**:
- **Strong**: 14ç¬”äº¤æ˜“, èƒœçŽ‡57.1%, å¹³å‡PnL=+0.21%
- **Medium**: 166ç¬”äº¤æ˜“, èƒœçŽ‡53.0%, å¹³å‡PnL=+0.12%
- **Weak**: 24ç¬”äº¤æ˜“, èƒœçŽ‡50.0%, å¹³å‡PnL=+0.03%

**å…³é”®å‘çŽ°**:
1. âœ… **æ€»æ”¶ç›Šæå‡**: 21.26% vs Pure 13.52% (+57%)
2. âš ï¸ **Sharpeä¸‹é™**: 0.26 vs Pure 0.76 (-66%)
3. âš ï¸ **æœ€å¤§å›žæ’¤å¢žåŠ **: -19.84% vs Pure -4.51% (4å€)
4. âš ï¸ **äº¤æ˜“æ•°æ¿€å¢ž**: 204 vs Pure 33 (6å€)ï¼Œå¯èƒ½è¿‡åº¦äº¤æ˜“

---

## ðŸ’¡ æ ¸å¿ƒæ´žå¯Ÿ

### 1. BTC vs XAU: æˆªç„¶ä¸åŒçš„è¡¨çŽ°

| ç»´åº¦ | BTCUSD 4H | XAUUSD 4H |
|------|-----------|-----------|
| **Dynamic vs Pure** | âœ… +150% æ”¶ç›Š | âœ… +57% æ”¶ç›Š |
| **Sharpeå˜åŒ–** | âœ… +65% | âš ï¸ -66% |
| **æœ€å¤§å›žæ’¤** | âœ… æ”¹å–„ (-20.79% â†’ -12.58%) | âš ï¸ æ¶åŒ– (-4.51% â†’ -19.84%) |
| **äº¤æ˜“æ•°** | âœ… åˆç† (6 â†’ 32) | âš ï¸ è¿‡å¤š (33 â†’ 204) |
| **ç»“è®º** | **å¼ºçƒˆæŽ¨è** | **éœ€è¦ä¼˜åŒ–** |

### 2. ä¿¡å·å¼ºåº¦åˆ†æ¡£çš„æœ‰æ•ˆæ€§

**BTCUSD**:
- âš ï¸ Strongä¿¡å·è¡¨çŽ°æœ€å·® (å¹³å‡PnL=-1.59%)
- âœ… Weakä¿¡å·è¡¨çŽ°æœ€å¥½ (å¹³å‡PnL=+3.59%, èƒœçŽ‡80%)
- ðŸ’¡ **åç›´è§‰å‘çŽ°**: å¼±ä¿¡å· + ç´§æ­¢æŸ/æ—©æ­¢ç›ˆ = æœ€ä½³è¡¨çŽ°

**XAUUSD**:
- âœ… Strongä¿¡å·è¡¨çŽ°æœ€å¥½ (å¹³å‡PnL=+0.21%)
- âš ï¸ Weakä¿¡å·è¡¨çŽ°æœ€å·® (å¹³å‡PnL=+0.03%)
- ðŸ’¡ **ç¬¦åˆé¢„æœŸ**: å¼ºä¿¡å· + å®½æ­¢æŸ = æ›´å¥½è¡¨çŽ°

### 3. ä¸ºä»€ä¹ˆBTC Strongä¿¡å·è¡¨çŽ°å·®ï¼Ÿ

å¯èƒ½åŽŸå› ï¼š
1. **2024å¹´ç‰¹æ®Šå¸‚åœº**: ä»…1å¹´æ•°æ®ï¼Œæ ·æœ¬é‡å°(4ç¬”äº¤æ˜“)
2. **æžç«¯åè½¬å¤±æ•ˆ**: 2024å¹´BTCè¶‹åŠ¿æ€§å¼ºï¼Œæžç«¯ä¿¡å·åŽå¯èƒ½ç»§ç»­è€Œéžåè½¬
3. **å‚æ•°ä¸åŒ¹é…**: Strongè§„åˆ™(SL=4, Trigger=3)å¯èƒ½å¯¹BTC 2024è¿‡äºŽå®½æ¾

---

## ðŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### A) æ‰©å±•æµ‹è¯•åˆ°æ›´é•¿æ—¶é—´å‘¨æœŸ â­â­â­

**ä¼˜å…ˆçº§**: æœ€é«˜

**åŽŸå› **: BTCUSDä»…æµ‹è¯•2024å¹´1å¹´æ•°æ®ï¼Œéœ€è¦éªŒè¯é•¿æœŸè¡¨çŽ°

**è¡ŒåŠ¨**:
```python
# æµ‹è¯•BTCUSD 2017-2024 (7-8å¹´)
# æµ‹è¯•ETHUSD 2017-2024 (7å¹´)
```

### B) ä¼˜åŒ–XAUUSDå‚æ•° â­â­

**é—®é¢˜**: äº¤æ˜“æ•°è¿‡å¤š(204ç¬”)ï¼Œæœ€å¤§å›žæ’¤è¿‡å¤§(-19.84%)

**ä¼˜åŒ–æ–¹å‘**:
1. æé«˜ä¿¡å·é˜ˆå€¼(90% â†’ 95%)ï¼Œå‡å°‘äº¤æ˜“æ•°
2. è°ƒæ•´Weakè§„åˆ™: SL 2â†’3 ATRï¼Œå‡å°‘æ­¢æŸé¢‘çŽ‡
3. æ·»åŠ æœ€å°æŒä»“æ—¶é—´(å¦‚5 bars)ï¼Œé¿å…è¿‡æ—©é€€å‡º

### C) åå‘æµ‹è¯•: Weakä¿¡å·ç”¨å®½å‚æ•° â­

**åŠ¨æœº**: BTCUSDæ•°æ®æ˜¾ç¤ºWeakä¿¡å·è¡¨çŽ°æœ€å¥½

**æµ‹è¯•**:
- Weakä¿¡å· â†’ ä½¿ç”¨Strongè§„åˆ™
- Strongä¿¡å· â†’ ä½¿ç”¨Weakè§„åˆ™
- éªŒè¯æ˜¯å¦"åç›´è§‰"ç­–ç•¥æ›´ä¼˜

### D) æ·»åŠ ç¬¬å››å±‚: å¸‚åœºçŠ¶æ€è¿‡æ»¤ â­â­

**æ¦‚å¿µ**: æ ¹æ®å¸‚åœºçŠ¶æ€(è¶‹åŠ¿/éœ‡è¡)è°ƒæ•´è§„åˆ™

**å®žçŽ°**:
```python
if market_regime == "trending":
    # ä½¿ç”¨continuationç­–ç•¥
elif market_regime == "mean_reverting":
    # ä½¿ç”¨reversalç­–ç•¥
```

---

## ðŸ“ ç”Ÿæˆæ–‡ä»¶

```
results/
â”œâ”€â”€ portfolio_dynamic_strength_exit_4h_summary.csv  # æ±‡æ€»ç»“æžœ
â”œâ”€â”€ BTCUSD_4h_dynamic_strength_trades.csv           # BTCäº¤æ˜“æ˜Žç»†
â”œâ”€â”€ BTCUSD_4h_dynamic_strength_equity.csv           # BTCæƒç›Šæ›²çº¿
â”œâ”€â”€ XAUUSD_4h_dynamic_strength_trades.csv           # XAUäº¤æ˜“æ˜Žç»†
â””â”€â”€ XAUUSD_4h_dynamic_strength_equity.csv           # XAUæƒç›Šæ›²çº¿

src/analysis/
â””â”€â”€ trade_strength_features.py                      # ä¿¡å·å¼ºåº¦ç‰¹å¾æ¨¡å—

src/backtest/
â”œâ”€â”€ dynamic_exit_rules.py                           # åŠ¨æ€é€€å‡ºè§„åˆ™é…ç½®
â””â”€â”€ portfolio_backtest_dynamic.py                   # åŠ¨æ€ç»„åˆå›žæµ‹å¼•æ“Ž

experiments/
â””â”€â”€ portfolio_dynamic_strength_exit_4h.py           # å®žéªŒè„šæœ¬
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-17  
**Phase**: 23 - Layer 3 Dynamic Exit System  
**çŠ¶æ€**: âœ… åˆæ­¥æµ‹è¯•å®Œæˆï¼ŒBTCUSDè¡¨çŽ°ä¼˜å¼‚ï¼ŒXAUUSDéœ€è¦ä¼˜åŒ–

