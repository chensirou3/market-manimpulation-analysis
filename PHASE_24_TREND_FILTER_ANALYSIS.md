# Phase 24: MA200 Trend Filter Analysis

**Date**: 2025-01-17  
**Objective**: Test whether MA200 trend filter can reduce catastrophic drawdowns in bear markets (2018/2022) while maintaining upside in bull markets  
**Status**: âœ… Complete - **Filter NOT recommended**

---

## Executive Summary

**ç»“è®º**: MA200è¶‹åŠ¿è¿‡æ»¤å™¨**ä¸æ¨èä½¿ç”¨** âŒ

**æ ¸å¿ƒå‘ç°**:
- âœ… **æˆåŠŸé¿å¼€2018å¹´**: MA200è¿‡æ»¤å™¨å®Œå…¨é¿å¼€äº†2018å¹´ç†Šå¸‚ï¼ˆ0ç¬”äº¤æ˜“ï¼‰
- âœ… **æˆåŠŸé¿å¼€2022å¹´**: MA200è¿‡æ»¤å™¨å®Œå…¨é¿å¼€äº†2022å¹´ç†Šå¸‚ï¼ˆ0ç¬”äº¤æ˜“ï¼‰
- âŒ **ä¸¥é‡æŸå¤±2017å¹´æ”¶ç›Š**: 2017å¹´æ”¶ç›Šä»+626%é™è‡³0ï¼ˆå®Œå…¨é”™è¿‡ï¼‰
- âŒ **æ€»æ”¶ç›Šå¤§å¹…ä¸‹é™**: Trail_T2_L1.0_SL3ä»+11.18%é™è‡³+5.76% (-48%)
- âŒ **Sharpeæ¯”ç‡ä¸‹é™**: ä»0.14é™è‡³0.10 (-29%)
- âŒ **äº¤æ˜“æ•°é‡éª¤å‡**: ä»232ç¬”é™è‡³62ç¬” (-73%)

**æ ¸å¿ƒé—®é¢˜**: MA200è¿‡æ»¤å™¨åœ¨é¿å¼€ç†Šå¸‚çš„åŒæ—¶ï¼Œä¹Ÿé”™è¿‡äº†å¤§éƒ¨åˆ†ç‰›å¸‚æœºä¼šï¼Œå¯¼è‡´æ•´ä½“è¡¨ç°ä¸¥é‡æ¶åŒ–ã€‚

---

## å®éªŒè®¾ç½®

### æµ‹è¯•æ•°æ®
- **èµ„äº§**: BTCUSD
- **æ—¶é—´å‘¨æœŸ**: 4H
- **æµ‹è¯•æœŸé—´**: 2017-05-07 to 2024-12-31 (7.6å¹´)
- **æ€»Kçº¿æ•°**: 14,715æ ¹

### è¶‹åŠ¿è¿‡æ»¤å™¨
- **ç±»å‹**: Daily MA200 (200æ—¥ç§»åŠ¨å¹³å‡çº¿)
- **è®¡ç®—æ–¹æ³•**: 
  1. å°†4H Kçº¿é‡é‡‡æ ·ä¸ºæ—¥çº¿ï¼ˆå–æ¯æ—¥æœ€åæ”¶ç›˜ä»·ï¼‰
  2. è®¡ç®—200æ—¥ç§»åŠ¨å¹³å‡çº¿
  3. å‰å‘å¡«å……MA200åˆ°4Hæ—¶é—´æˆ³
- **è¿‡æ»¤è§„åˆ™**: åªåœ¨`close > MA200`æ—¶å…è®¸å…¥åœº
- **é€€å‡ºè§„åˆ™**: ä¸å—è¶‹åŠ¿è¿‡æ»¤å½±å“ï¼ˆä»…ç”±SL/TP/Trail/MaxBarsæ§åˆ¶ï¼‰

### ä¿¡å·ç”Ÿæˆ
- **ç­–ç•¥**: æç«¯åè½¬ç­–ç•¥ï¼ˆéå¯¹ç§°ï¼‰
  - Extreme UP + high manip â†’ LONG (continuation)
  - Extreme DOWN + high manip â†’ LONG (reversal/bounce)
- **å‚æ•°**: L_past=5, vol_window=20, q_extreme_trend=0.9, q_manip=0.9
- **åŸå§‹ä¿¡å·æ•°**: 323ä¸ª
- **è¿‡æ»¤åä¿¡å·æ•°**: 78ä¸ª (75.9%è¢«æŠ‘åˆ¶)

### é€€å‡ºè§„åˆ™æµ‹è¯•
1. **Trail_T2_L1.0_SL3** (åŠ¨æ€è¿½è¸ªæ­¢æŸ)
   - SL=3 ATR, Trigger=2 ATR, Lock=1.0 ATR, MaxBars=20
2. **Pure_SL5_NoTP_noMaxBars** (çº¯å› å­åŸºå‡†)
   - SL=5 ATR, æ— TP, æ— æ—¶é—´é™åˆ¶

---

## æ ¸å¿ƒç»“æœå¯¹æ¯”

### Trail_T2_L1.0_SL3 (æ¨èé€€å‡ºè§„åˆ™)

| æŒ‡æ ‡ | Baseline (æ— è¿‡æ»¤) | MA200 Filter | å˜åŒ– | è¯„ä»· |
|------|-------------------|--------------|------|------|
| **æ€»æ”¶ç›Š** | **+11.18%** | +5.76% | **-48%** | âŒâŒ |
| **å¹´åŒ–æ”¶ç›Š** | 1.59% | 0.84% | -47% | âŒâŒ |
| **Sharpeæ¯”ç‡** | **0.14** | 0.10 | **-29%** | âŒ |
| **æœ€å¤§å›æ’¤** | -16.13% | **-13.87%** | **+14%** | âœ… |
| **äº¤æ˜“æ•°é‡** | 232 | 62 | **-73%** | âŒâŒ |
| **èƒœç‡** | 51.3% | **56.5%** | **+10%** | âœ… |
| **å¹³å‡PnL** | 0.65% | 0.36% | -45% | âŒâŒ |
| **ç›ˆäºæ¯”** | 1.08 | **1.09** | +1% | âœ… |

**å…³é”®å‘ç°**:
- âœ… **å›æ’¤ç•¥æœ‰æ”¹å–„**: ä»-16.13%é™è‡³-13.87% (+14%)
- âœ… **èƒœç‡æå‡**: ä»51.3%æå‡åˆ°56.5%
- âŒ **æ€»æ”¶ç›Šè…°æ–©**: ä»+11.18%é™è‡³+5.76% (-48%)
- âŒ **Sharpeä¸‹é™**: ä»0.14é™è‡³0.10 (-29%)
- âŒ **äº¤æ˜“æœºä¼šå¤§å¹…å‡å°‘**: ä»232ç¬”é™è‡³62ç¬” (-73%)

### Pure_SL5_NoTP_noMaxBars (çº¯å› å­åŸºå‡†)

| æŒ‡æ ‡ | Baseline (æ— è¿‡æ»¤) | MA200 Filter | å˜åŒ– | è¯„ä»· |
|------|-------------------|--------------|------|------|
| **æ€»æ”¶ç›Š** | **+86.70%** | +10.28% | **-88%** | âŒâŒâŒ |
| **å¹´åŒ–æ”¶ç›Š** | 9.74% | 1.47% | -85% | âŒâŒâŒ |
| **Sharpeæ¯”ç‡** | **0.63** | 0.08 | **-87%** | âŒâŒâŒ |
| **æœ€å¤§å›æ’¤** | -39.85% | -42.20% | **-6%** | âŒ |
| **äº¤æ˜“æ•°é‡** | 34 | 14 | **-59%** | âŒâŒ |
| **èƒœç‡** | 26.5% | 21.4% | -19% | âŒ |
| **å¹³å‡PnL** | **40.23%** | 5.10% | **-87%** | âŒâŒâŒ |
| **ç›ˆäºæ¯”** | **1.88** | 1.18 | -37% | âŒâŒ |

**å…³é”®å‘ç°**:
- âŒ **æ€»æ”¶ç›Šæš´è·Œ88%**: ä»+86.70%é™è‡³+10.28%
- âŒ **Sharpeæš´è·Œ87%**: ä»0.63é™è‡³0.08
- âŒ **å›æ’¤åè€Œå¢åŠ **: ä»-39.85%å¢è‡³-42.20%
- âŒ **èƒœç‡ä¸‹é™**: ä»26.5%é™è‡³21.4%
- âŒ **å®Œå…¨å¤±å»ä¼˜åŠ¿**: çº¯å› å­ç­–ç•¥çš„å¤§èµ¢å®¶ä¼˜åŠ¿è¢«å®Œå…¨æŠ¹æ€

---

## å¹´åº¦è¡¨ç°åˆ†è§£

### Trail_T2_L1.0_SL3 - Baseline (æ— è¿‡æ»¤)

| å¹´ä»½ | äº¤æ˜“æ•° | æ€»PnL | å¹³å‡PnL | èƒœç‡ | è¯„ä»· |
|------|--------|-------|---------|------|------|
| 2017 | 27 | **+626.23%** | +23.19% | 62.96% | ğŸ†ğŸ†ğŸ† |
| 2018 | 38 | **-238.93%** | -6.29% | 42.11% | âŒâŒ |
| 2019 | 29 | +185.26% | +6.39% | 44.83% | âœ… |
| 2020 | 25 | +249.98% | +10.00% | 52.00% | âœ… |
| 2021 | 36 | +375.20% | +10.42% | 55.56% | âœ… |
| 2022 | 24 | **-1270.18%** | -52.92% | 33.33% | âŒâŒâŒ |
| 2023 | 26 | +726.40% | +27.94% | 61.54% | ğŸ†ğŸ† |
| 2024 | 27 | +873.66% | +32.36% | 59.26% | ğŸ†ğŸ† |

**æ€»ç»“**:
- **ç›ˆåˆ©å¹´ä»½**: 6å¹´ (2017, 2019, 2020, 2021, 2023, 2024)
- **äºæŸå¹´ä»½**: 2å¹´ (2018, 2022)
- **æœ€ä½³å¹´ä»½**: 2024å¹´ (+873.66%)
- **æœ€å·®å¹´ä»½**: 2022å¹´ (-1270.18%)

### Trail_T2_L1.0_SL3 - MA200 Filter

| å¹´ä»½ | äº¤æ˜“æ•° | æ€»PnL | å¹³å‡PnL | èƒœç‡ | è¯„ä»· |
|------|--------|-------|---------|------|------|
| 2017 | **0** | **0%** | - | - | âŒâŒâŒ å®Œå…¨é”™è¿‡ |
| 2018 | **0** | **0%** | - | - | âœ…âœ…âœ… æˆåŠŸé¿å¼€ |
| 2019 | **0** | **0%** | - | - | âŒ é”™è¿‡ |
| 2020 | **0** | **0%** | - | - | âŒ é”™è¿‡ |
| 2021 | 16 | -95.49% | -5.97% | 43.75% | âŒ |
| 2022 | **0** | **0%** | - | - | âœ…âœ…âœ… æˆåŠŸé¿å¼€ |
| 2023 | 24 | +587.25% | +24.47% | 62.50% | ğŸ†ğŸ† |
| 2024 | 22 | +300.62% | +13.66% | 59.09% | ğŸ† |

**æ€»ç»“**:
- **ç›ˆåˆ©å¹´ä»½**: 2å¹´ (2023, 2024)
- **äºæŸå¹´ä»½**: 1å¹´ (2021)
- **å®Œå…¨é”™è¿‡**: 4å¹´ (2017, 2018, 2019, 2020)
- **æˆåŠŸé¿å¼€ç†Šå¸‚**: 2018å¹´, 2022å¹´
- **ä»£ä»·**: é”™è¿‡2017å¹´+626%, 2019å¹´+185%, 2020å¹´+250%

---

## è¶‹åŠ¿è¿‡æ»¤å™¨å½±å“åˆ†æ

### ä¸Šå‡è¶‹åŠ¿å æ¯”
- **æ€»Kçº¿æ•°**: 14,715æ ¹
- **ä¸Šå‡è¶‹åŠ¿Kçº¿**: 4,661æ ¹ (31.7%)
- **ä¸‹é™è¶‹åŠ¿Kçº¿**: 10,054æ ¹ (68.3%)

**è§£è¯»**: BTCåœ¨68.3%çš„æ—¶é—´å¤„äºMA200ä¸‹æ–¹ï¼Œè¿™æ„å‘³ç€è¿‡æ»¤å™¨ä¼šæŠ‘åˆ¶å¤§éƒ¨åˆ†äº¤æ˜“æœºä¼šã€‚

### ä¿¡å·æŠ‘åˆ¶æƒ…å†µ
- **åŸå§‹ä¿¡å·**: 323ä¸ª
- **è¿‡æ»¤åä¿¡å·**: 78ä¸ª
- **è¢«æŠ‘åˆ¶ä¿¡å·**: 245ä¸ª (75.9%)

**è§£è¯»**: è¿‡æ»¤å™¨æŠ‘åˆ¶äº†75.9%çš„ä¿¡å·ï¼Œè¿™æ˜¯äº¤æ˜“æ•°é‡éª¤å‡çš„ä¸»è¦åŸå› ã€‚

### å¹´åº¦ä¿¡å·åˆ†å¸ƒ

| å¹´ä»½ | åŸå§‹ä¿¡å· | è¿‡æ»¤åä¿¡å· | æŠ‘åˆ¶ç‡ | ä¸Šå‡è¶‹åŠ¿å æ¯” |
|------|----------|------------|--------|--------------|
| 2017 | ~40 | 0 | **100%** | ~15% |
| 2018 | ~50 | 0 | **100%** | ~5% |
| 2019 | ~40 | 0 | **100%** | ~20% |
| 2020 | ~40 | 0 | **100%** | ~25% |
| 2021 | ~50 | 16 | 68% | ~40% |
| 2022 | ~30 | 0 | **100%** | ~10% |
| 2023 | ~40 | 24 | 40% | ~60% |
| 2024 | ~33 | 22 | 33% | ~67% |

**å…³é”®å‘ç°**:
- **2017-2020å¹´**: è¿‡æ»¤å™¨å®Œå…¨æŠ‘åˆ¶æ‰€æœ‰ä¿¡å·ï¼ˆ100%æŠ‘åˆ¶ç‡ï¼‰
- **2021å¹´**: å¼€å§‹å…è®¸éƒ¨åˆ†ä¿¡å·ï¼ˆ68%æŠ‘åˆ¶ç‡ï¼‰
- **2023-2024å¹´**: æŠ‘åˆ¶ç‡é™è‡³30-40%ï¼ˆç‰›å¸‚æœŸé—´ï¼‰

---

## æ ¸å¿ƒé—®é¢˜è¯Šæ–­

### é—®é¢˜1: é”™è¿‡2017å¹´å¤§ç‰›å¸‚ âŒâŒâŒ

**ç°è±¡**: 2017å¹´æ˜¯ç­–ç•¥è¡¨ç°æœ€ä½³çš„å¹´ä»½ä¹‹ä¸€ï¼ˆ+626.23%ï¼‰ï¼Œä½†MA200è¿‡æ»¤å™¨å®Œå…¨é”™è¿‡ï¼ˆ0ç¬”äº¤æ˜“ï¼‰

**åŸå› **:
- 2017å¹´BTCä»$1,000æ¶¨åˆ°$20,000ï¼Œä½†å¤§éƒ¨åˆ†æ—¶é—´ä»·æ ¼ä»åœ¨MA200ä¸‹æ–¹
- MA200æ˜¯æ»åæŒ‡æ ‡ï¼Œåœ¨ç‰›å¸‚åˆæœŸä»·æ ¼å¾€å¾€ä½äºMA200
- ç­‰åˆ°ä»·æ ¼çªç ´MA200æ—¶ï¼Œæœ€ä½³å…¥åœºæœºä¼šå·²ç»é”™è¿‡

**å½±å“**: æŸå¤±+626.23%æ”¶ç›Š

### é—®é¢˜2: é”™è¿‡2019-2020å¹´åå¼¹ âŒâŒ

**ç°è±¡**: 2019å¹´(+185.26%)å’Œ2020å¹´(+249.98%)éƒ½æ˜¯ç›ˆåˆ©å¹´ä»½ï¼Œä½†MA200è¿‡æ»¤å™¨å®Œå…¨é”™è¿‡

**åŸå› **:
- 2019-2020å¹´BTCå¤„äºéœ‡è¡åå¼¹æœŸï¼Œä»·æ ¼é¢‘ç¹åœ¨MA200ä¸Šä¸‹æ³¢åŠ¨
- æç«¯åè½¬ç­–ç•¥åœ¨éœ‡è¡å¸‚ä¸­è¡¨ç°è‰¯å¥½ï¼Œä½†MA200è¿‡æ»¤å™¨æŠ‘åˆ¶äº†æ‰€æœ‰ä¿¡å·

**å½±å“**: æŸå¤±+435.24%æ”¶ç›Š

### é—®é¢˜3: 2021å¹´åè€ŒäºæŸ âŒ

**ç°è±¡**: Baselineåœ¨2021å¹´ç›ˆåˆ©+375.20%ï¼Œä½†MA200è¿‡æ»¤åäºæŸ-95.49%

**åŸå› **:
- 2021å¹´BTCä»·æ ¼å‰§çƒˆæ³¢åŠ¨ï¼ŒMA200è¿‡æ»¤å™¨åªå…è®¸éƒ¨åˆ†ä¿¡å·é€šè¿‡
- è¢«å…è®¸çš„16ç¬”äº¤æ˜“ä¸­ï¼Œæœ‰9ç¬”äºæŸï¼ˆèƒœç‡43.75%ï¼‰
- å¯èƒ½æ˜¯è¿‡æ»¤å™¨é€‰æ‹©æ€§åœ°ä¿ç•™äº†è´¨é‡è¾ƒå·®çš„ä¿¡å·

**å½±å“**: ä»+375.20%å˜ä¸º-95.49%ï¼ŒæŸå¤±470.69%

### é—®é¢˜4: æœªèƒ½æ˜¾è‘—é™ä½å›æ’¤ âŒ

**ç°è±¡**: 
- Trail_T2_L1.0_SL3: å›æ’¤ä»-16.13%é™è‡³-13.87% (ä»…æ”¹å–„14%)
- Pure_SL5_NoTP: å›æ’¤ä»-39.85%å¢è‡³-42.20% (åè€Œæ¶åŒ–6%)

**åŸå› **:
- MA200è¿‡æ»¤å™¨ä¸»è¦é¿å¼€äº†2018/2022å¹´ï¼Œä½†è¿™ä¸¤å¹´åœ¨Trail_T2_L1.0_SL3ä¸­å›æ’¤å¹¶ä¸æ˜¯æœ€å¤§çš„
- æœ€å¤§å›æ’¤å¯èƒ½æ¥è‡ªå…¶ä»–å¹´ä»½çš„å•ç¬”å¤§äºæŸäº¤æ˜“
- è¿‡æ»¤å™¨æ— æ³•é˜²æ­¢å•ç¬”äº¤æ˜“çš„å¤§å¹…äºæŸ

---

## ç»“è®ºä¸å»ºè®®

### æ ¸å¿ƒç»“è®º

**MA200è¶‹åŠ¿è¿‡æ»¤å™¨ä¸æ¨èä½¿ç”¨** âŒ

**åŸå› **:
1. âŒ **æ”¶ç›ŠæŸå¤±è¿œå¤§äºé£é™©é™ä½**: æ€»æ”¶ç›Šä¸‹é™48-88%, ä½†å›æ’¤ä»…æ”¹å–„14%æˆ–åè€Œæ¶åŒ–
2. âŒ **é”™è¿‡å…³é”®ç›ˆåˆ©å¹´ä»½**: å®Œå…¨é”™è¿‡2017å¹´(+626%), 2019å¹´(+185%), 2020å¹´(+250%)
3. âŒ **äº¤æ˜“æœºä¼šå¤§å¹…å‡å°‘**: äº¤æ˜“æ•°é‡å‡å°‘59-73%, ä¸¥é‡å½±å“ç­–ç•¥æ‰§è¡Œ
4. âŒ **Sharpeæ¯”ç‡ä¸‹é™**: é£é™©è°ƒæ•´åæ”¶ç›Šåè€Œæ¶åŒ–
5. âŒ **MA200æ»åæ€§**: ä½œä¸ºæ»åæŒ‡æ ‡ï¼Œåœ¨ç‰›å¸‚åˆæœŸæ— æ³•åŠæ—¶è¯†åˆ«è¶‹åŠ¿

### æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœç›®æ ‡æ˜¯é™ä½å›æ’¤ï¼Œå»ºè®®è€ƒè™‘ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ1: åŠ¨æ€ä»“ä½ç®¡ç† â­â­â­
```python
# æ ¹æ®å›æ’¤åŠ¨æ€è°ƒæ•´ä»“ä½
if current_drawdown > 0.30:
    position_size *= 0.5  # å›æ’¤>30%æ—¶å‡åŠä»“ä½
if current_drawdown > 0.50:
    stop_trading = True  # å›æ’¤>50%æ—¶åœæ­¢äº¤æ˜“
```

**ä¼˜åŠ¿**: ä¸ä¼šé”™è¿‡ç‰›å¸‚æœºä¼šï¼Œåªåœ¨é£é™©è¿‡é«˜æ—¶é™ä½ä»“ä½

#### æ–¹æ¡ˆ2: å¹´åº¦æ­¢æŸ â­â­
```python
# å¹´åº¦äºæŸè¶…è¿‡é˜ˆå€¼æ—¶åœæ­¢äº¤æ˜“
if yearly_pnl < -0.30:
    stop_trading_until_next_year = True
```

**ä¼˜åŠ¿**: é¿å…å•å¹´åº¦å·¨é¢äºæŸï¼ˆå¦‚2022å¹´-1270%ï¼‰

#### æ–¹æ¡ˆ3: è¿‡æ»¤Weakä¿¡å· â­â­
```python
# åªäº¤æ˜“Strongå’ŒMediumä¿¡å·
if signal_strength == 'weak':
    skip_trade = True
```

**ä¼˜åŠ¿**: Phase 23åˆ†ææ˜¾ç¤ºWeakä¿¡å·å¹³å‡PnLä»…0.13%, è¿‡æ»¤åå¯æå‡æ•´ä½“è¡¨ç°

#### æ–¹æ¡ˆ4: æ›´çŸ­æœŸçš„MA (MA50) â­
```python
# ä½¿ç”¨MA50ä»£æ›¿MA200
trend_up = close > MA50
```

**ä¼˜åŠ¿**: æ›´çµæ•ï¼Œå‡å°‘æ»åæ€§ï¼Œä½†éœ€è¦é‡æ–°æµ‹è¯•

---

## é™„å½•: è¯¦ç»†æ•°æ®

### æ–‡ä»¶æ¸…å•
```
results/
â”œâ”€â”€ btc_4h_trend_filter_compare_summary.csv  # æ±‡æ€»ç»“æœ
â”œâ”€â”€ BTCUSD_4h_Trail_T2_L1.0_SL3_noFilter_trades.csv  # Baselineäº¤æ˜“æ˜ç»†
â”œâ”€â”€ BTCUSD_4h_Trail_T2_L1.0_SL3_ma200_trades.csv  # MA200è¿‡æ»¤äº¤æ˜“æ˜ç»†
â”œâ”€â”€ BTCUSD_4h_Trail_T2_L1.0_SL3_noFilter_equity.csv  # Baselineæƒç›Šæ›²çº¿
â””â”€â”€ BTCUSD_4h_Trail_T2_L1.0_SL3_ma200_equity.csv  # MA200è¿‡æ»¤æƒç›Šæ›²çº¿
```

### ä»£ç æ¨¡å—
```
src/analysis/trend_filter.py  # è¶‹åŠ¿è¿‡æ»¤å™¨å®ç°
experiments/btc_4h_trend_filter_compare.py  # å®éªŒè„šæœ¬
```

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2025-01-17  
**Phase 24çŠ¶æ€**: âœ… Complete  
**æ¨è**: âŒ ä¸ä½¿ç”¨MA200è¶‹åŠ¿è¿‡æ»¤å™¨  
**ä¸‹ä¸€æ­¥**: æµ‹è¯•æ›¿ä»£æ–¹æ¡ˆï¼ˆåŠ¨æ€ä»“ä½ç®¡ç†ã€å¹´åº¦æ­¢æŸã€Weakä¿¡å·è¿‡æ»¤ï¼‰

