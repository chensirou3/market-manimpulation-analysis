# 数据验证报告 / Data Validation Report

**验证日期**: 2025-11-14  
**验证状态**: ✅ **通过所有测试**

---

## 📊 数据概览

### 基本信息

- **数据文件数**: 3,338 个 Parquet 文件
- **数据总大小**: 7.49 GB (7,672.24 MB)
- **数据年份**: 2015 - 2025 (共 11 年)
- **数据格式**: Parquet (高效压缩格式)
- **交易品种**: XAUUSD (黄金/美元)

### 数据结构

| 列名 | 数据类型 | 说明 |
|------|----------|------|
| `timestamp` | datetime64[ns, UTC] | UTC 时间戳 |
| `price` | float64 | 中间价 (从 bid/ask 计算) |
| `volume` | float64 | 总成交量 (bid_size + ask_size) |
| `bid` | float64 | 买价 |
| `ask` | float64 | 卖价 |
| `spread` | float64 | 买卖价差 |
| `bid_size` | float64 | 买单量 |
| `ask_size` | float64 | 卖单量 |
| `source` | object | 数据来源 |
| `symbol` | object | 交易品种 |
| `offsession` | bool | 是否盘后 |
| `is_spike` | bool | 是否异常波动 |

---

## ✅ 测试结果

### 测试 1: 单日数据加载 ✅

**测试日期**: 2024-01-01

**结果**:
- ✅ 成功加载 2,220 条 tick 数据
- ✅ 时间范围: 23:00:00 - 23:59:55 (约 1 小时)
- ✅ 所有列正确加载
- ✅ 数据类型正确

**示例数据**:
```
                         timestamp      price  volume    bid    ask  spread
0 2024-01-01 23:00:00.312000+00:00  2063.5800     2.0  2063.32  2063.84  0.52
1 2024-01-01 23:00:01.170000+00:00  2063.8400     2.0  2063.58  2064.10  0.52
```

**价格统计**:
- 最小价格: 2063.25
- 最大价格: 2066.88
- 平均价格: 2065.01
- 标准差: 0.75

---

### 测试 2: 日期范围加载 ✅

**测试日期**: 2024-01-01 至 2024-01-05

**结果**:
- ✅ 成功加载 593,107 条 tick 数据
- ✅ 跨越 5 天
- ✅ 数据连续性良好

**每日数据量**:
| 日期 | 数据量 |
|------|--------|
| 2024-01-01 | 2,220 条 |
| 2024-01-02 | 137,108 条 |
| 2024-01-03 | 161,554 条 |
| 2024-01-04 | 125,368 条 |
| 2024-01-05 | 166,857 条 |

**观察**:
- 2024-01-01 数据量较少（可能是节假日或仅部分交易时段）
- 其他日期数据量充足（10万+ 条/天）

---

### 测试 3: 最近数据加载 ✅

**测试日期**: 2025-01-01

**结果**:
- ✅ 成功加载 2,093 条 tick 数据
- ✅ 时间范围: 23:00:00 - 23:59:59
- ✅ 数据格式与历史数据一致

---

### 测试 4: 数据质量检查 ✅

**测试日期**: 2024-01-02 (选择数据量充足的日期)

**结果**:
- ✅ 无缺失值 (所有列 100% 完整)
- ✅ 价格合理 (2055.98 - 2078.99)
- ✅ 成交量合理 (固定为 2.0)
- ✅ 无重复时间戳
- ✅ 时间序列连续

**详细检查**:

#### 缺失值检查
- ✅ 所有 12 列均无缺失值

#### 价格检查
- 最小价格: 2055.98
- 最大价格: 2078.99
- 平均价格: 2067.72
- 标准差: 5.10
- ✅ 所有价格为正数

#### 成交量检查
- 最小成交量: 2.00
- 最大成交量: 2.00
- 平均成交量: 2.00
- ✅ 成交量固定（可能是 bid_size + ask_size 均为 1.0）

#### 时间序列检查
- 平均时间间隔: 0.63 秒
- 最小时间间隔: 0.05 秒 (50ms)
- 最大时间间隔: 1小时2秒 (可能是交易暂停)
- ✅ 无重复时间戳
- ✅ 时间序列单调递增

---

## 🔧 数据适配

### 已实现的列名映射

项目代码已成功适配您的数据格式：

| 原始列名 | 标准列名 | 转换方式 |
|----------|----------|----------|
| `ts_utc` (int64, 毫秒) | `timestamp` (datetime64[ns, UTC]) | `pd.to_datetime(ts_utc, unit='ms', utc=True)` |
| `bid`, `ask` | `price` | `(bid + ask) / 2` |
| `bid_size`, `ask_size` | `volume` | `bid_size + ask_size` |
| `bid`, `ask`, `spread` 等 | 保留原列 | 直接保留 |

### 时区处理

- ✅ 数据时间戳为 UTC 时区
- ✅ 日期过滤时自动转换为 UTC 时区
- ✅ 避免了时区不匹配错误

---

## 📈 数据特点

### 优点

1. **数据量充足**: 11 年历史数据，3,338 个文件
2. **格式统一**: 所有文件使用 Parquet 格式，加载速度快
3. **结构清晰**: 按年/月/日分区，易于管理
4. **质量高**: 无缺失值，时间序列连续
5. **信息丰富**: 包含 bid/ask/spread 等详细信息

### 注意事项

1. **成交量固定**: 所有 tick 的 volume 均为 2.0 (bid_size=1.0, ask_size=1.0)
   - 这可能是 quote 数据而非 trade 数据
   - 适合用于价格分析，但成交量分析可能受限

2. **部分日期数据量少**: 如 2024-01-01 仅 2,220 条
   - 可能是节假日或仅部分交易时段
   - 使用时需注意数据覆盖范围

3. **时间间隔不均**: 平均 0.63 秒，但有较大波动
   - 最小 50ms，最大 1小时+
   - 需要在分析时考虑时间加权

---

## 🚀 使用建议

### 1. 加载数据

```python
from src.data_prep.tick_loader import load_tick_data

# 加载单日数据
df = load_tick_data(start_date='2024-01-02', end_date='2024-01-02')

# 加载日期范围
df = load_tick_data(start_date='2024-01-01', end_date='2024-01-31')
```

### 2. 聚合为 Bar 数据

```python
from src.data_prep.bar_aggregator import ticks_to_bars

# 聚合为 5 分钟 K 线
bars = ticks_to_bars(df, timeframe='5min', compute_features=True)
```

### 3. 运行完整分析

```python
# 使用真实数据运行项目
python quick_start.py
```

---

## 📝 下一步行动

### 立即可做

1. ✅ **数据已验证** - 可以开始使用
2. ✅ **加载器已适配** - 无需修改代码
3. ✅ **测试已通过** - 功能正常

### 建议操作

1. **运行完整流程**
   ```bash
   python quick_start.py
   ```

2. **探索数据**
   - 打开 `notebooks/explore_data.ipynb`
   - 加载真实数据进行探索性分析

3. **测试异常检测**
   - 使用真实数据测试操纵检测算法
   - 调整参数以适应数据特点

4. **回测策略**
   - 使用 ManipScore 因子过滤交易信号
   - 对比过滤前后的策略表现

---

## ✅ 结论

**数据状态**: ✅ **完全可用**

您的数据已成功导入并通过所有验证测试。数据质量高，格式统一，项目代码已完全适配您的数据格式。

**可以立即开始使用项目进行交易操纵检测分析！**

---

## 📞 快速参考

### 数据加载示例

```python
# 示例 1: 加载单日数据
from src.data_prep.tick_loader import load_tick_data

df = load_tick_data(start_date='2024-01-02', end_date='2024-01-02')
print(f"加载了 {len(df):,} 条 tick 数据")
print(df.head())

# 示例 2: 加载一周数据
df_week = load_tick_data(start_date='2024-01-01', end_date='2024-01-07')

# 示例 3: 聚合为 K 线
from src.data_prep.bar_aggregator import ticks_to_bars

bars_5min = ticks_to_bars(df, timeframe='5min')
bars_1h = ticks_to_bars(df, timeframe='1h')
```

### 数据统计

- **总文件数**: 3,338
- **总大小**: 7.49 GB
- **年份范围**: 2015-2025
- **品种**: XAUUSD
- **平均文件大小**: ~2.3 MB
- **平均每日数据量**: ~10-16 万条 tick

---

**验证完成时间**: 2025-11-14 15:50  
**验证状态**: ✅ **全部通过**

