# å®žç›˜äº¤æ˜“æŒ‡å—

## ðŸŽ¯ æ ¸å¿ƒç»“è®º

**å¯¹äºŽ60åˆ†é’Ÿå’Œ4å°æ—¶ç­–ç•¥ï¼Œåªéœ€è¦Kçº¿æ•°æ®å³å¯ï¼ä¸éœ€è¦tickæ•°æ®ã€‚**

---

## ðŸ“‹ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install ccxt pandas numpy scikit-learn
```

### 2. è®­ç»ƒæ¨¡å¼ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰

```bash
python live_trading_example.py --mode train --symbol BTC/USDT --timeframe 1h
```

è¿™ä¼šï¼š
- âœ… ä»Žå¸å®‰èŽ·å–5000ä¸ªåŽ†å²Kçº¿
- âœ… è®­ç»ƒManipScoreæ¨¡åž‹
- âœ… è®¡ç®—TSå’ŒManipScoreé˜ˆå€¼
- âœ… ä¿å­˜æ¨¡åž‹åˆ° `models/` ç›®å½•

### 3. å®žç›˜æ¨¡å¼

```bash
python live_trading_example.py --mode live --symbol BTC/USDT --timeframe 1h
```

è¿™ä¼šï¼š
- âœ… åŠ è½½è®­ç»ƒå¥½çš„æ¨¡åž‹å’Œé˜ˆå€¼
- âœ… æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ä¿¡å·
- âœ… æ‰“å°å½“å‰çŠ¶æ€å’Œä¿¡å·

---

## ðŸ“Š æ•°æ®éœ€æ±‚

### âœ… åªéœ€è¦Kçº¿æ•°æ®ï¼ˆOHLCï¼‰

```python
# ä»Žä»»ä½•äº¤æ˜“æ‰€APIèŽ·å–
ohlcv = exchange.fetch_ohlcv('BTC/USDT', '1h', limit=5000)

# éœ€è¦çš„å­—æ®µ
bars = pd.DataFrame({
    'timestamp': [...],
    'open': [...],
    'high': [...],
    'low': [...],
    'close': [...],
    'volume': [...]  # å¯é€‰
})
```

### âŒ ä¸éœ€è¦tickæ•°æ®

- ä¸éœ€è¦bid/askä»·æ ¼
- ä¸éœ€è¦é€ç¬”æˆäº¤æ•°æ®
- ä¸éœ€è¦è®¢å•ç°¿æ•°æ®

---

## ðŸ”§ é…ç½®å‚æ•°

### æŽ¨èé…ç½®ï¼ˆ60åˆ†é’Ÿç­–ç•¥ï¼‰

```python
symbol = 'BTC/USDT'
timeframe = '1h'
L_past = 5              # è¶‹åŠ¿å›žçœ‹çª—å£
vol_window = 20         # æ³¢åŠ¨çŽ‡çª—å£
q_extreme_trend = 0.9   # æžç«¯è¶‹åŠ¿é˜ˆå€¼ï¼ˆ90%åˆ†ä½æ•°ï¼‰
q_manip = 0.9          # é«˜æ“çºµé˜ˆå€¼ï¼ˆ90%åˆ†ä½æ•°ï¼‰
holding_horizon = 5     # æŒä»“æ—¶é—´ï¼ˆ5ä¸ªbar = 5å°æ—¶ï¼‰
sl_atr_mult = 0.5      # æ­¢æŸï¼ˆ0.5å€ATRï¼‰
tp_atr_mult = 0.8      # æ­¢ç›ˆï¼ˆ0.8å€ATRï¼‰
cost_per_trade = 0.0007 # äº¤æ˜“æˆæœ¬ï¼ˆ7bp = 0.07%ï¼‰
```

### æŽ¨èé…ç½®ï¼ˆ4å°æ—¶ç­–ç•¥ï¼‰

```python
symbol = 'BTC/USDT'
timeframe = '4h'
L_past = 5
vol_window = 20
q_extreme_trend = 0.9
q_manip = 0.9
holding_horizon = 5     # 5ä¸ªbar = 20å°æ—¶
sl_atr_mult = 0.5
tp_atr_mult = 0.8
cost_per_trade = 0.0007
```

---

## ðŸ“ˆ æ€§èƒ½é¢„æœŸ

### BTC 60åˆ†é’Ÿç­–ç•¥ï¼ˆ7bpæˆæœ¬ï¼‰

- **å¹´åŒ–æ”¶ç›Š**: 33.25%
- **Sharpeæ¯”çŽ‡**: 16.50
- **æœ€å¤§å›žæ’¤**: -31.17%
- **äº¤æ˜“é¢‘çŽ‡**: æ¯2.5å¤©ä¸€ç¬”
- **å¹³å‡æŒä»“**: 5å°æ—¶
- **èƒœçŽ‡**: 52.6%

### BTC 4å°æ—¶ç­–ç•¥ï¼ˆ7bpæˆæœ¬ï¼‰

- **å¹´åŒ–æ”¶ç›Š**: 14.87%
- **Sharpeæ¯”çŽ‡**: 107.91
- **æœ€å¤§å›žæ’¤**: -35.24%
- **äº¤æ˜“é¢‘çŽ‡**: æ¯11.5å¤©ä¸€ç¬”
- **å¹³å‡æŒä»“**: 20å°æ—¶
- **èƒœçŽ‡**: 50.0%

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ¨¡åž‹è®­ç»ƒ

- **åŽ†å²æ•°æ®é‡**: è‡³å°‘1000ä¸ªbarï¼ŒæŽ¨è5000ä¸ª
- **æ›´æ–°é¢‘çŽ‡**: å»ºè®®æ¯å‘¨æˆ–æ¯æœˆæ›´æ–°ä¸€æ¬¡
- **éªŒè¯**: è®­ç»ƒåŽæ£€æŸ¥ä¿¡å·é¢‘çŽ‡ï¼ˆåº”è¯¥åœ¨1-3%ï¼‰

### 2. é˜ˆå€¼è®¡ç®—

- **æ»šåŠ¨çª—å£**: ä½¿ç”¨æœ€è¿‘500ä¸ªbarè®¡ç®—é˜ˆå€¼
- **åˆ†ä½æ•°**: 90%åˆ†ä½æ•°ï¼ˆå¯è°ƒæ•´ï¼‰
- **æ›´æ–°**: ä¸Žæ¨¡åž‹åŒæ­¥æ›´æ–°

### 3. é£Žé™©ç®¡ç†

- **æ­¢æŸæ­¢ç›ˆ**: ä½¿ç”¨ATRå€æ•°ï¼ˆ0.5å€æ­¢æŸï¼Œ0.8å€æ­¢ç›ˆï¼‰
- **ä»“ä½ç®¡ç†**: å»ºè®®æ¯æ¬¡ä½¿ç”¨10%èµ„é‡‘
- **äº¤æ˜“æˆæœ¬**: ç¡®è®¤å®žé™…æˆæœ¬ï¼ˆå»ºè®®7bpï¼‰

### 4. æ•°æ®è´¨é‡

```python
# æ£€æŸ¥Kçº¿æ•°æ®è´¨é‡
def validate_bars(bars):
    # æ£€æŸ¥ç¼ºå¤±å€¼
    assert not bars.isnull().any().any(), "æ•°æ®åŒ…å«ç¼ºå¤±å€¼"
    
    # æ£€æŸ¥ä»·æ ¼åˆç†æ€§
    assert (bars['high'] >= bars['low']).all(), "high < low"
    assert (bars['high'] >= bars['close']).all(), "close > high"
    assert (bars['low'] <= bars['close']).all(), "close < low"
    
    # æ£€æŸ¥æ—¶é—´è¿žç»­æ€§
    time_diff = bars.index.to_series().diff()
    expected_diff = pd.Timedelta('1h')  # æ ¹æ®timeframeè°ƒæ•´
    assert (time_diff[1:] == expected_diff).all(), "æ—¶é—´ä¸è¿žç»­"
```

---

## ðŸ“ æ–‡ä»¶ç»“æž„

```
market-manimpulation-analysis/
â”œâ”€â”€ live_trading_example.py          # å®žç›˜äº¤æ˜“è„šæœ¬
â”œâ”€â”€ models/                           # æ¨¡åž‹å’Œé˜ˆå€¼ä¿å­˜ç›®å½•
â”‚   â”œâ”€â”€ manipscore_model_1h.pkl      # ManipScoreæ¨¡åž‹
â”‚   â””â”€â”€ thresholds_1h.pkl            # é˜ˆå€¼
â”œâ”€â”€ ç­–ç•¥æŠ€æœ¯æ–‡æ¡£_å®Œæ•´å¤çŽ°æŒ‡å—.md      # å®Œæ•´æŠ€æœ¯æ–‡æ¡£
â””â”€â”€ README_å®žç›˜äº¤æ˜“.md               # æœ¬æ–‡ä»¶
```

---

## ðŸ” æ•…éšœæŽ’é™¤

### é—®é¢˜1: æ¨¡åž‹æ–‡ä»¶ä¸å­˜åœ¨

```
é”™è¯¯: æ¨¡åž‹æˆ–é˜ˆå€¼æ–‡ä»¶ä¸å­˜åœ¨
```

**è§£å†³**: å…ˆè¿è¡Œè®­ç»ƒæ¨¡å¼
```bash
python live_trading_example.py --mode train
```

### é—®é¢˜2: æ•°æ®ä¸è¶³

```
ValueError: æ•°æ®ä¸è¶³: åªæœ‰50ä¸ªæœ‰æ•ˆæ ·æœ¬ï¼Œéœ€è¦è‡³å°‘100ä¸ª
```

**è§£å†³**: å¢žåŠ åŽ†å²æ•°æ®é‡
```bash
python live_trading_example.py --mode train --limit 10000
```

### é—®é¢˜3: APIé™åˆ¶

```
ccxt.errors.RateLimitExceeded
```

**è§£å†³**: å¢žåŠ æ£€æŸ¥é—´éš”
```bash
python live_trading_example.py --mode live --interval 7200  # 2å°æ—¶
```

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æŠ€æœ¯æ–‡æ¡£**: `ç­–ç•¥æŠ€æœ¯æ–‡æ¡£_å®Œæ•´å¤çŽ°æŒ‡å—.md`
- **ç­–ç•¥å¿«é€Ÿå‚è€ƒ**: `ç­–ç•¥å¿«é€Ÿå‚è€ƒå¡.md`
- **å‰è§†åå·®å®¡è®¡**: `LOOK_AHEAD_BIAS_AUDIT_REPORT.md`
- **ä¿®å¤æŠ¥å‘Š**: `å‰è§†åå·®ä¿®å¤å®ŒæˆæŠ¥å‘Š.md`

---

## ðŸ’¡ æœ€ä½³å®žè·µ

### 1. å…ˆåœ¨æµ‹è¯•ç½‘æµ‹è¯•

```python
# ä½¿ç”¨å¸å®‰æµ‹è¯•ç½‘
exchange = ccxt.binance({
    'apiKey': 'YOUR_TESTNET_API_KEY',
    'secret': 'YOUR_TESTNET_SECRET',
    'options': {'defaultType': 'future'},
    'urls': {
        'api': {
            'public': 'https://testnet.binancefuture.com',
            'private': 'https://testnet.binancefuture.com',
        }
    }
})
```

### 2. è®°å½•æ‰€æœ‰äº¤æ˜“

```python
import logging

logging.basicConfig(
    filename='trading.log',
    level=logging.INFO,
    format='%(asctime)s - %(message)s'
)

logging.info(f"ä¿¡å·: {signal}, ä»·æ ¼: {price}, TS: {TS}, ManipScore: {MS}")
```

### 3. å®šæœŸç›‘æŽ§

- æ¯å¤©æ£€æŸ¥äº¤æ˜“æ—¥å¿—
- æ¯å‘¨æ£€æŸ¥ç­–ç•¥è¡¨çŽ°
- æ¯æœˆæ›´æ–°æ¨¡åž‹å’Œé˜ˆå€¼

---

## ðŸŽ¯ æ€»ç»“

**å®žç›˜äº¤æ˜“åªéœ€è¦Kçº¿æ•°æ®ï¼**

1. âœ… ç®€å•æ˜“ç”¨
2. âœ… æ•°æ®æ˜“èŽ·å–
3. âœ… æ€§èƒ½è‰¯å¥½
4. âœ… é€‚åˆä¸­ä½Žé¢‘ç­–ç•¥

**å¼€å§‹å®žç›˜å‰çš„æ£€æŸ¥æ¸…å•**:

- [ ] å®‰è£…æ‰€æœ‰ä¾èµ–
- [ ] è¿è¡Œè®­ç»ƒæ¨¡å¼
- [ ] éªŒè¯ä¿¡å·ç”Ÿæˆ
- [ ] åœ¨æµ‹è¯•ç½‘æµ‹è¯•
- [ ] è®¾ç½®é£Žé™©ç®¡ç†
- [ ] é…ç½®æ—¥å¿—è®°å½•
- [ ] å¼€å§‹å°ä»“ä½å®žç›˜

